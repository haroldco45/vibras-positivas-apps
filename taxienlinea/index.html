<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi Radar - Control Conductor</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --amarillo: #ffcc00; --negro: #1a1a1a; --verde: #2ecc71; --rojo: #e74c3c; --blanco: #ffffff; }
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 0; background: #f4f4f4; overflow: hidden; }
        
        header { 
            background: var(--negro); padding: 15px; text-align: center; border-bottom: 4px solid var(--amarillo);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); position: relative; z-index: 1001;
        }
        .logo-taxi { width: 60px; height: 60px; object-fit: contain; }
        .app-title { color: var(--amarillo); margin: 5px 0 0; font-size: 16px; font-weight: bold; }
        .taxi-info-header { color: white; font-size: 11px; margin-top: 3px; }

        #map { height: calc(100vh - 250px); width: 100%; position: relative; z-index: 1; }

        .panel-control { 
            height: 150px; background: white; padding: 15px; text-align: center; 
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1); border-radius: 25px 25px 0 0; 
            position: relative; z-index: 1000; margin-top: -30px;
        }
        
        .status-badge { 
            display: inline-block; padding: 5px 12px; border-radius: 50px; 
            font-weight: bold; font-size: 11px; margin-bottom: 8px; 
        }
        .disponible { background: var(--verde); color: white; }
        .ocupado { background: var(--rojo); color: white; }

        .btn-taxi { 
            background: var(--amarillo); color: var(--negro); border: none; padding: 15px 20px; 
            border-radius: 12px; font-weight: bold; font-size: 16px; width: 100%; 
            cursor: pointer; box-shadow: 0 4px 0 #b38f00; transition: 0.2s;
        }
        .btn-taxi:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; color: #666; }

        /* BOT√ìN SECRETO CONDUCTOR */
        .btn-admin {
            position: fixed; top: 15px; right: 15px; z-index: 1002;
            background: rgba(255,255,255,0.2); border: none; border-radius: 50%;
            width: 40px; height: 40px; color: white; font-size: 20px; cursor: pointer;
        }

        /* MODAL DE CONTROL */
        #modal-conductor {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000; color: white; text-align: center; padding-top: 100px;
        }
        .modal-content { background: var(--negro); width: 80%; margin: auto; padding: 20px; border-radius: 20px; border: 2px solid var(--amarillo); }

        .taxi-marker { font-size: 40px; transition: all 0.5s linear; } 
        .taxi-marker.red { filter: hue-rotate(140deg) brightness(0.8); } /* Cambia el emoji a rojizo */
    </style>
</head>
<body>

<button class="btn-admin" onclick="abrirAdmin()">‚öôÔ∏è</button>

<div id="modal-conductor">
    <div class="modal-content">
        <h2>PANEL CONDUCTOR</h2>
        <p>Cambia tu estado actual:</p>
        <button class="btn-taxi" style="background:var(--verde); color:white; margin-bottom: 10px;" onclick="cambiarEstado('disponible')">ESTOY DISPONIBLE</button>
        <button class="btn-taxi" style="background:var(--rojo); color:white;" onclick="cambiarEstado('ocupado')">ESTOY OCUPADO</button>
        <br><br>
        <button onclick="cerrarAdmin()" style="color:var(--amarillo); background:none; border:none; font-size:14px;">Cerrar Panel</button>
    </div>
</div>

<header>
    <img src="taxi.PNG" alt="Logo" class="logo-taxi">
    <div class="app-title">TAXI RADAR CAUCASIA</div>
    <div class="taxi-info-header">
        üöñ <span id="txt-nombre">CARGANDO...</span> | üÜî <span id="txt-placa">CARGANDO...</span>
    </div>
</header>

<div id="map"></div>

<div class="panel-control">
    <div id="status-badge" class="status-badge disponible">üü¢ CONDUCTOR DISPONIBLE</div>
    <button id="btn-pedido" class="btn-taxi" onclick="solicitarConGPS()">üöÄ SOLICITAR RECOGIDA (ENV√çA MI GPS)</button>
    <footer style="font-size:10px; color:#aaa; margin-top:10px;">VIBRAS POSITIVAS ¬© 2026</footer>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const TAXISTA = {
        nombre: "JUAN CARLOS ESPINOZA",
        celular: "573117700431",
        placa: "XYZ-123",
        ubicacionInicial: [7.986, -75.193]
    };

    document.getElementById('txt-nombre').innerText = TAXISTA.nombre;
    document.getElementById('txt-placa').innerText = TAXISTA.placa;

    let map, marker, estadoActual = 'disponible';

    function initMap() {
        map = L.map('map', { zoomControl: false }).setView(TAXISTA.ubicacionInicial, 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        const taxiIcon = L.divIcon({ className: 'taxi-marker', html: 'üöï', iconSize: [40, 40], iconAnchor: [20, 20] });
        marker = L.marker(TAXISTA.ubicacionInicial, { icon: taxiIcon }).addTo(map);
    }

    // --- FUNCIONES DE ADMINISTRACI√ìN ---
    function abrirAdmin() { document.getElementById('modal-conductor').style.display = 'block'; }
    function cerrarAdmin() { document.getElementById('modal-conductor').style.display = 'none'; }

    function cambiarEstado(nuevoEstado) {
        estadoActual = nuevoEstado;
        const badge = document.getElementById('status-badge');
        const btnPedido = document.getElementById('btn-pedido');
        
        if(nuevoEstado === 'disponible') {
            badge.className = 'status-badge disponible';
            badge.innerText = 'üü¢ CONDUCTOR DISPONIBLE';
            btnPedido.disabled = false;
            btnPedido.innerText = 'üöÄ SOLICITAR RECOGIDA (ENV√çA MI GPS)';
            marker._icon.classList.remove('red');
        } else {
            badge.className = 'status-badge ocupado';
            badge.innerText = 'üî¥ CONDUCTOR OCUPADO';
            btnPedido.disabled = true;
            btnPedido.innerText = 'üö´ TAXI OCUPADO POR EL MOMENTO';
            marker._icon.classList.add('red'); // El taxi se pone oscuro/rojo en el mapa
        }
        cerrarAdmin();
    }

    function rastrear() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition((pos) => {
                const coord = [pos.coords.latitude, pos.coords.longitude];
                marker.setLatLng(coord);
                map.panTo(coord);
            }, null, { enableHighAccuracy: true });
        }
    }

    function solicitarConGPS() {
        if(estadoActual === 'ocupado') return alert("El taxi est√° ocupado en este momento.");
        
        navigator.geolocation.getCurrentPosition((pos) => {
            const gps = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
            const msg = `*üöñ SOLICITUD DE TAXI*\n--------------------------\nüöï *CONDUCTOR:* ${TAXISTA.nombre}\nüÜî *PLACA:* ${TAXISTA.placa}\nüìç *RECOGER AQU√ç:* ${gps}\n--------------------------\n_V√≠a Vibras Positivas_`;
            window.location.href = `https://wa.me/${TAXISTA.celular}?text=${encodeURIComponent(msg)}`;
        });
    }

    window.onload = () => { initMap(); rastrear(); };
</script>
</body>
</html>
