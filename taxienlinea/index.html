<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi Radar - Pedido con GPS</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --amarillo: #ffcc00; --negro: #1a1a1a; --verde: #2ecc71; --rojo: #e74c3c; --blanco: #ffffff; }
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 0; background: #f4f4f4; overflow: hidden; }
        
        header { 
            background: var(--negro); 
            padding: 15px; 
            text-align: center; 
            border-bottom: 4px solid var(--amarillo);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1001;
        }
        .logo-taxi { width: 70px; height: 70px; object-fit: contain; }
        .app-title { color: var(--amarillo); margin: 5px 0 0; font-size: 16px; font-weight: bold; }
        .taxi-info-header { color: white; font-size: 11px; margin-top: 3px; }

        #map { height: calc(100vh - 250px); width: 100%; position: relative; z-index: 1; }

        .panel-control { 
            height: 150px; 
            background: white; 
            padding: 15px; 
            text-align: center; 
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1); 
            border-radius: 25px 25px 0 0; 
            position: relative; 
            z-index: 1000; 
            margin-top: -30px;
        }
        
        .status-badge { 
            display: inline-block; 
            padding: 5px 12px; 
            border-radius: 50px; 
            font-weight: bold; 
            font-size: 11px; 
            margin-bottom: 8px; 
        }
        .disponible { background: var(--verde); color: white; }

        .btn-taxi { 
            background: var(--amarillo); 
            color: var(--negro); 
            border: none; 
            padding: 15px 20px; 
            border-radius: 12px; 
            font-weight: bold; 
            font-size: 16px; 
            width: 100%; 
            cursor: pointer; 
            box-shadow: 0 4px 0 #b38f00; 
            transition: 0.2s;
        }
        .btn-taxi:active { transform: translateY(3px); box-shadow: none; }

        footer { font-size: 10px; color: #aaa; margin-top: 8px; text-align: center; }
        .taxi-marker { font-size: 35px; transition: all 0.5s linear; } 
    </style>
</head>
<body>

<div id="bloqueo" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; color:white; z-index:9999; text-align:center; padding-top:100px;">
    <h1>üîí SERVICIO SUSPENDIDO</h1>
</div>

<header>
    <img src="taxi.PNG" alt="Logo" class="logo-taxi">
    <div class="app-title">TAXI RADAR CAUCASIA</div>
    <div class="taxi-info-header">
        üöñ Conductor: <span id="txt-nombre">CARGANDO...</span> | üÜî Placa: <span id="txt-placa">CARGANDO...</span>
    </div>
</header>

<div id="map"></div>

<div class="panel-control">
    <div id="status" class="status-badge disponible">üü¢ CONDUCTOR DISPONIBLE</div>
    
    <button class="btn-taxi" onclick="solicitarConGPS()">
        üöÄ SOLICITAR RECOGIDA (ENV√çA MI GPS)
    </button>

    <footer>
        App desarrollada por <b>VIBRAS POSITIVAS</b> ¬© 2026 <br>
        Caucasia, Antioquia
    </footer>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // --- DATOS DEL TAXISTA (C√ÅMBIALOS AQU√ç) ---
    const TAXISTA = {
        nombre: "JUAN CARLOS ESPINOZA", // Ejemplo
        celular: "573117700431",
        placa: "XYZ-123", // Ejemplo
        ubicacionInicial: [7.986, -75.193]
    };

    // Colocar datos en la cabecera
    document.getElementById('txt-nombre').innerText = TAXISTA.nombre;
    document.getElementById('txt-placa').innerText = TAXISTA.placa;

    let map, marker;

    function initMap() {
        map = L.map('map', { zoomControl: false }).setView(TAXISTA.ubicacionInicial, 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        const taxiIcon = L.divIcon({
            className: 'taxi-marker',
            html: 'üöï',
            iconSize: [40, 40],
            iconAnchor: [20, 20]
        });

        marker = L.marker(TAXISTA.ubicacionInicial, { icon: taxiIcon }).addTo(map);
    }

    function rastrear() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition((pos) => {
                const coord = [pos.coords.latitude, pos.coords.longitude];
                marker.setLatLng(coord);
                map.panTo(coord);
            }, null, { enableHighAccuracy: true });
        }
    }

    // --- NUEVA FUNCI√ìN CON CAPTURA DE GPS DEL PASAJERO ---
    function solicitarConGPS() {
        const btn = document.querySelector('.btn-taxi');
        btn.innerText = "‚åõ LOCALIZ√ÅNDOTE...";
        btn.style.opacity = "0.7";

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const gpsPasajero = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
                    enviarWhatsApp(gpsPasajero);
                },
                () => {
                    // Si el pasajero no da permiso GPS, env√≠a el mensaje b√°sico
                    enviarWhatsApp("Ubicaci√≥n no proporcionada por el cliente");
                },
                { timeout: 5000 }
            );
        } else {
            enviarWhatsApp("GPS no soportado en este m√≥vil");
        }
    }

    function enviarWhatsApp(ubicacionLink) {
        const btn = document.querySelector('.btn-taxi');
        
        // Formato de factura/informaci√≥n solicitado
        let msg = `*üöñ SOLICITUD DE TAXI - RADAR*\n`;
        msg += `--------------------------\n`;
        msg += `üöï *CONDUCTOR:* ${TAXISTA.nombre}\n`;
        msg += `üÜî *PLACA:* ${TAXISTA.placa}\n`;
        msg += `üìû *CONTACTO:* ${TAXISTA.celular}\n`;
        msg += `--------------------------\n`;
        msg += `üìç *MI UBICACI√ìN (RECOGER AQU√ç):*\n${ubicacionLink}\n`;
        msg += `--------------------------\n`;
        msg += `_Solicitado v√≠a Vibras Positivas_`;

        btn.innerText = "üöÄ SOLICITAR RECOGIDA (ENV√çA MI GPS)";
        btn.style.opacity = "1";

        window.location.href = `https://wa.me/${TAXISTA.celular}?text=${encodeURIComponent(msg)}`;
    }

    window.onload = () => {
        initMap();
        rastrear();
    };
</script>
</body>
</html>
