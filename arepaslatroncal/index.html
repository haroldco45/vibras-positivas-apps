<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Arepas La Troncal - Pedidos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ffcc00; --secondary: #e67e22; --dark: #1a1a1a; --light: #f4f4f4; --success: #25d366; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background: var(--light); color: var(--dark); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        header { background: var(--primary); padding: 15px; text-align: center; border-bottom: 4px solid var(--secondary); box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 10; }
        header h1 { font-size: 1.3rem; text-transform: uppercase; font-weight: 600; }

        .content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 160px; }

        /* Datos del Cliente */
        .customer-data { background: #fff3cd; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #ffeeba; }
        .customer-data h2 { font-size: 0.85rem; margin-bottom: 10px; text-align: center; color: #856404; font-weight: 600; }
        input { width: 100%; padding: 12px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 10px; font-family: inherit; font-size: 14px; outline: none; }

        /* Tarjeta de Producto */
        .product-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 6px solid var(--secondary); }
        .product-info h3 { font-size: 0.95rem; margin-bottom: 2px; }
        .product-price { color: var(--secondary); font-weight: 600; font-size: 0.9rem; }
        .product-desc { font-size: 0.75rem; color: #666; }

        .qty-control { display: flex; align-items: center; gap: 12px; background: #eee; padding: 6px 12px; border-radius: 12px; }
        .btn-qty { border: none; background: white; width: 30px; height: 30px; border-radius: 8px; font-weight: bold; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .qty-num { font-weight: 600; min-width: 15px; text-align: center; font-size: 1.1rem; }

        /* CajÃ³n de Total Mejorado */
        .total-container { background: var(--dark); color: white; padding: 20px; border-radius: 20px; text-align: center; margin: 20px 0; border: 2px solid var(--primary); }
        .total-label { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: #aaa; }
        .total-amount { font-size: 2.2rem; font-weight: 600; color: var(--primary); display: block; }

        /* Footer y Firma */
        .footer-action { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 12px 15px; border-top: 1px solid #eee; z-index: 100; }
        .btn-whatsapp { background: var(--success); color: white; border: none; width: 100%; padding: 16px; border-radius: 15px; font-weight: bold; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4); }
        
        .copyright { text-align: center; font-size: 0.65rem; color: #bbb; margin-top: 15px; text-transform: uppercase; letter-spacing: 1.5px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header>
        <h1>Arepas La Troncal ðŸŒ½</h1>
    </header>

    <div class="content">
        <div class="customer-data">
            <h2>ðŸšš DATOS DE ENTREGA</h2>
            <input type="text" id="c-name" placeholder="Escribe tu Nombre">
            <input type="number" id="c-phone" placeholder="NÃºmero de Celular">
            <input type="text" id="c-address" placeholder="DirecciÃ³n exacta">
        </div>

        <div id="menu-list">
            </div>

        <div class="total-container">
            <span class="total-label">Valor total a pagar</span>
            <span class="total-amount">$<span id="total-val">0</span></span>
        </div>

        <button id="btn-admin-access" style="opacity: 0.05; background: none; border: none; width: 100%; padding: 20px; font-size: 0.5rem;">ADMIN</button>
        <div id="admin-panel" class="hidden" style="background: #fff; padding: 15px; border-radius: 15px; border: 1px dashed #ccc;">
            <input type="text" id="p-name" placeholder="Nombre del producto">
            <input type="number" id="p-price" placeholder="Precio">
            <button onclick="saveNewProduct()" style="width:100%; padding:12px; background:var(--secondary); color:white; border-radius:10px; border:none; font-weight:bold;">+ AGREGAR PRODUCTO</button>
        </div>

        <p class="copyright">Desarrollada por Vibras Positivas Â© 2026<br>Todos los derechos reservados</p>
    </div>

    <div class="footer-action">
        <button class="btn-whatsapp" onclick="processOrder()">
            ðŸš€ PEDIR POR WHATSAPP
        </button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC6Mcmm-TBrFuTiQ0IjIHq9XD620DNsI",
            databaseURL: "https://motoapp-e4261-default-rtdb.firebaseio.com",
            projectId: "motoapp-e4261",
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const WS_NUMBER = "573122493344";
        let userPos = "";

        // Captura de ubicaciÃ³n
        navigator.geolocation.getCurrentPosition(p => {
            userPos = `https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`;
        }, null, {enableHighAccuracy: true});

        // Producto inicial configurado segÃºn tu instrucciÃ³n
        let products = JSON.parse(localStorage.getItem('troncal_prods')) || [
            { id: 1, name: "Paquete de Arepas x 5 Unid.", price: 5000, qty: 0, desc: "MaÃ­z blanco tradicional" }
        ];

        window.renderMenu = () => {
            const list = document.getElementById('menu-list');
            list.innerHTML = "";
            let total = 0;

            products.forEach((p, i) => {
                total += (p.qty || 0) * p.price;
                const div = document.createElement('div');
                div.className = "product-card";
                div.innerHTML = `
                    <div class="product-info">
                        <h3>${p.name}</h3>
                        <div class="product-desc">${p.desc || 'Deliciosas y frescas'}</div>
                        <div class="product-price">$${p.price.toLocaleString()}</div>
                    </div>
                    <div class="qty-control">
                        <button class="btn-qty" onclick="updateP(${i}, -1)">-</button>
                        <span class="qty-num">${p.qty || 0}</span>
                        <button class="btn-qty" onclick="updateP(${i}, 1)">+</button>
                    </div>`;
                list.appendChild(div);
            });
            document.getElementById('total-val').innerText = total.toLocaleString();
        };

        window.updateP = (i, val) => {
            products[i].qty = Math.max(0, (products[i].qty || 0) + val);
            renderMenu();
        };

        window.processOrder = () => {
            const name = document.getElementById('c-name').value.trim();
            const phone = document.getElementById('c-phone').value.trim();
            const address = document.getElementById('c-address').value.trim();
            const ordered = products.filter(p => p.qty > 0);

            if (!name || !phone || !address) return alert("Por favor, completa tus datos de entrega âœï¸");
            if (ordered.length === 0) return alert("Selecciona cuÃ¡ntas arepas deseas llevar ðŸŒ½");

            let msg = `*ðŸ§¾ NUEVO PEDIDO - AREPAS LA TRONCAL*%0A`;
            msg += `------------------------------------------%0A`;
            msg += `ðŸ‘¤ *CLIENTE:* ${name.toUpperCase()}%0A`;
            msg += `ðŸ“ž *CELULAR:* ${phone}%0A`;
            msg += `ðŸ“ *DIRECCIÃ“N:* ${address}%0A`;
            if(userPos) msg += `ðŸ“ *UBICACIÃ“N GPS:* ${userPos}%0A`;
            msg += `------------------------------------------%0A`;
            msg += `*PRODUCTOS:*%0A`;

            let total = 0;
            ordered.forEach(p => {
                const sub = p.qty * p.price;
                msg += `âœ… ${p.qty} x ${p.name} -> *$${sub.toLocaleString()}*%0A`;
                total += sub;
            });

            msg += `------------------------------------------%0A`;
            msg += `ðŸ’° *TOTAL A COBRAR: $${total.toLocaleString()}*%0A`;
            msg += `------------------------------------------%0A`;
            msg += `_Enviado desde Vibras Positivas WebApp_`;

            window.open(`https://wa.me/${WS_NUMBER}?text=${msg}`);
        };

        window.saveNewProduct = () => {
            const n = document.getElementById('p-name').value;
            const p = document.getElementById('p-price').value;
            if(n && p) {
                products.push({ id: Date.now(), name: n, price: parseInt(p), qty: 0 });
                localStorage.setItem('troncal_prods', JSON.stringify(products));
                renderMenu();
                document.getElementById('admin-panel').classList.add('hidden');
            }
        };

        document.getElementById('btn-admin-access').onclick = () => {
            if(prompt("Clave Admin:") === "vibras") document.getElementById('admin-panel').classList.toggle('hidden');
        };

        renderMenu();
    </script>
</body>
</html>
