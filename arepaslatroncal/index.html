<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Arepas La Troncal - Pedidos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ffcc00; --secondary: #e67e22; --dark: #2c3e50; --light: #f8f9fa; --success: #25d366; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background: var(--light); color: var(--dark); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        header { background: var(--primary); padding: 15px; text-align: center; border-bottom: 4px solid var(--secondary); box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 10; }
        header h1 { font-size: 1.3rem; text-transform: uppercase; }

        .content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 150px; }

        /* Formulario de Datos del Cliente */
        .customer-data { background: #fff3cd; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #ffeeba; }
        .customer-data h2 { font-size: 0.9rem; margin-bottom: 10px; text-align: center; color: #856404; }
        input { width: 100%; padding: 12px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 10px; font-family: inherit; font-size: 14px; outline: none; }

        /* Tarjetas de Producto */
        .product-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); }
        .product-info h3 { font-size: 1rem; margin-bottom: 2px; }
        .product-price { color: var(--secondary); font-weight: 600; font-size: 0.9rem; }

        .qty-control { display: flex; align-items: center; gap: 12px; background: #f0f0f0; padding: 5px 10px; border-radius: 10px; }
        .btn-qty { border: none; background: white; width: 28px; height: 28px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .qty-num { font-weight: 600; min-width: 15px; text-align: center; }

        /* Caj√≥n de Total */
        .total-box { background: var(--dark); color: white; padding: 15px; border-radius: 15px; text-align: center; margin-top: 20px; }
        .total-box span { font-size: 1.5rem; font-weight: bold; color: var(--primary); }

        /* Footer y Firma */
        .footer-action { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 10px 15px; border-top: 1px solid #eee; z-index: 100; }
        .btn-whatsapp { background: var(--success); color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; }
        .copyright { text-align: center; font-size: 0.6rem; color: #999; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header>
        <h1>Arepas La Troncal üåΩ</h1>
    </header>

    <div class="content">
        <div class="customer-data">
            <h2>üìù DATOS DEL PEDIDO</h2>
            <input type="text" id="c-name" placeholder="Tu Nombre">
            <input type="number" id="c-phone" placeholder="Tu Celular">
            <input type="text" id="c-address" placeholder="Direcci√≥n de entrega">
        </div>

        <div id="menu-list">
            </div>

        <div class="total-box">
            TOTAL DEL PEDIDO<br>
            $<span id="total-val">0</span>
        </div>

        <button id="btn-admin-access" style="opacity: 0.1; background: none; border: none; width: 100%; margin-top: 30px; font-size: 0.5rem;">‚öôÔ∏è ADMIN</button>
        <div id="admin-panel" class="hidden">
            <input type="text" id="p-name" placeholder="Nuevo Producto">
            <input type="number" id="p-price" placeholder="Precio">
            <button onclick="saveNewProduct()" style="width:100%; padding:10px; background:var(--secondary); color:white; border-radius:10px; border:none;">+ AGREGAR</button>
        </div>

        <p class="copyright">Desarrollada por Vibras Positivas ¬© 2026<br>Todos los derechos reservados</p>
    </div>

    <div class="footer-action">
        <button class="btn-whatsapp" onclick="processOrder()">
            ‚úÖ ENVIAR PEDIDO A WHATSAPP
        </button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC6Mcmm-TBrFuTiQ0IjIHq9XD620DNsI",
            databaseURL: "https://motoapp-e4261-default-rtdb.firebaseio.com",
            projectId: "motoapp-e4261",
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const WS_NUMBER = "573122493344";
        let userPos = "";

        // Captura GPS invisible
        navigator.geolocation.getCurrentPosition(p => {
            userPos = `https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`;
        });

        let products = JSON.parse(localStorage.getItem('troncal_prods')) || [
            { id: 1, name: "Paquete de Arepa Ma√≠z Blanco", price: 5000, qty: 0 }
        ];

        window.renderMenu = () => {
            const list = document.getElementById('menu-list');
            list.innerHTML = "";
            let total = 0;

            products.forEach((p, i) => {
                total += (p.qty || 0) * p.price;
                const div = document.createElement('div');
                div.className = "product-card";
                div.innerHTML = `
                    <div class="product-info">
                        <h3>${p.name}</h3>
                        <div class="product-price">$${p.price.toLocaleString()}</div>
                    </div>
                    <div class="qty-control">
                        <button class="btn-qty" onclick="updateP(${i}, -1)">-</button>
                        <span class="qty-num">${p.qty || 0}</span>
                        <button class="btn-qty" onclick="updateP(${i}, 1)">+</button>
                    </div>`;
                list.appendChild(div);
            });
            document.getElementById('total-val').innerText = total.toLocaleString();
        };

        window.updateP = (i, val) => {
            products[i].qty = Math.max(0, (products[i].qty || 0) + val);
            renderMenu();
        };

        window.processOrder = () => {
            const name = document.getElementById('c-name').value;
            const phone = document.getElementById('c-phone').value;
            const address = document.getElementById('c-address').value;
            const ordered = products.filter(p => p.qty > 0);

            if (!name || !phone || !address) return alert("Completa tus datos para el env√≠o üìù");
            if (ordered.length === 0) return alert("¬øCu√°ntas arepas vas a llevar? üåΩ");

            let msg = `*üßæ NUEVO PEDIDO - AREPAS LA TRONCAL*%0A`;
            msg += `----------------------------------------%0A`;
            msg += `*CLIENTE:* ${name.toUpperCase()}%0A`;
            msg += `*CELULAR:* ${phone}%0A`;
            msg += `*DIRECCI√ìN:* ${address}%0A`;
            if(userPos) msg += `*UBICACI√ìN GPS:* ${userPos}%0A`;
            msg += `----------------------------------------%0A`;
            msg += `*DETALLE DEL PEDIDO:*%0A`;

            let total = 0;
            ordered.forEach(p => {
                const sub = p.qty * p.price;
                msg += `‚Ä¢ ${p.qty} x ${p.name} ($${sub.toLocaleString()})%0A`;
                total += sub;
            });

            msg += `----------------------------------------%0A`;
            msg += `*TOTAL A COBRAR: $${total.toLocaleString()}*%0A`;
            msg += `----------------------------------------%0A`;
            msg += `_Pedido generado por Vibras Positivas App_`;

            window.open(`https://wa.me/${WS_NUMBER}?text=${msg}`);
        };

        window.saveNewProduct = () => {
            const n = document.getElementById('p-name').value;
            const p = document.getElementById('p-price').value;
            if(n && p) {
                products.push({ id: Date.now(), name: n, price: parseInt(p), qty: 0 });
                localStorage.setItem('troncal_prods', JSON.stringify(products));
                renderMenu();
                document.getElementById('admin-panel').classList.add('hidden');
            }
        };

        document.getElementById('btn-admin-access').onclick = () => {
            if(prompt("Clave:") === "vibras") document.getElementById('admin-panel').classList.toggle('hidden');
        };

        renderMenu();
    </script>
</body>
</html>
